# Utilities to test SoF Check chess engine

These utilities include:

- [Data extractor from PGNs](#data-extractor-from-pgns)
- [Position cost tester](#position-cost-tester)
- [Battlefield](#battlefield)
- [Data generator for selftests](#data-generator-for-selftests)
- [Test position set for BattleField](#test-position-set-for-battlefield)

This project is mostly written in Pascal, as it relies on core libraries of
[Chess 256](https://github.com/alex65536/Chess256). These libraries were taken from the source
code of Chess 256 and slightly modified.

## Dependencies

On Debian/Ubuntu, you need to install the following packages:

- `fpc (>= 3.0.0)`
- `lcl-units (>= 2.0)`
- `lcl-utils (>= 2.0)`
- `stockfish`
- `lzma`
- `python3 (>= 3.6)`

## Utilities

### Data extractor from PGNs

This utility prepares the test data for the engine. It extracts all the positions from given PGN
files and runs Stockfish to get the cost of all the moves in this position. The data generated by
this utility can be used with `engine_test` utility.

You can use `build_data.sh` script to build the data. Build time is about 23 hours on my laptop,
so it's not recommended to create data manually. Better use the prebuilt data files. It is located
in `data/positions.data.lzma`.

### Position cost tester

This utility is used to test the position cost and various search prunings. It works in the
following way:

- gets positions from data files prepared by `build_data.sh`
- runs the engine on each position
- compares the best move and the move found by our engine:
  - suppose that our engine has depth `7` and finds move `e2e4`, while Stockfish found move `d2d4`
    on the same depth
  - the _best score_ is the score of `d2d4` on depth `7` (score is calculated by Stockfish)
  - the _calculated score_ is the score of `e2e4` on depth `7` (score is calculated by Stockfish)
  - the _error_ is the difference between the best score and the calculated score
- reports the statistics (based on given positions and computed _error_)

To use this utility, run `engine_test/engine_test.py`. Run it with `--help` option to get more
details on how to use it.

### Battlefield

BattleField is a tool to run many micro engine matches. It allows two engines to play many games
either on fixed time per move or on fixed depth.

To build this utility, run

~~~~~
$ cd battlefield
$ lazbuild Battlefield.lpi
~~~~~

Alternatively, you can open and build the project `battlefield/Battlefield.lpi` in Lazarus IDE.

The resulting binary is located in `battlefield/bin/battlefield`. Run the binary without arguments
to get more information on how to use it.

### Data generator for selftests

This small tool generates the positions for
[self-tests](https://github.com/alex65536/sofcheck/tree/master/selftest). To compile and run it,
use

~~~~~
$ cd selftest_data_create
$ lazbuild SelftestDataCreate.lpi
$ cd bin
$ ./selftest_data_create >boards.fen
~~~~~

The resulting `boards.fen` will be the same as `boards.fen` which is used for self-tests in
SoFCheck repository.

### Test position set for BattleField

This is not a utility, but a set of positions on which the engine evaluation function is tested.
These positions can be used with BattleField.

# License

GNU GPL v3 (or any later version)
